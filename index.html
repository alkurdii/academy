<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÛØ¨ÙˆØ§Ø±Û Ø²Ø§Ù†ÛŒÙ†Û - Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ø²Ø§Ù†Ø³ØªÛŒ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rudaw&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121828;
            --primary-dark: #1B233F;
            --secondary-dark: #2A3459;
            --accent-gold: #D4AF37;
            --text-light: #E0E0E0;
            --text-muted: #A0A0E0;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107; /* RengÃª bo Ã§averÃªbÃ»nÃª */
            --font-body: 'Rudaw', sans-serif;
            --font-arabic: 'Amiri', serif;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background-color: var(--bg-dark); color: var(--text-light); line-height: 1.8; overflow-x: hidden; }
        .sidebar { width: 120px; background-color: var(--primary-dark); padding: 25px 15px; height: 100vh; position: fixed; top: 0; right: 0; border-left: 2px solid var(--secondary-dark); transition: transform 0.3s ease-in-out; z-index: 1000; }
        .sidebar.closed { transform: translateX(120px); }
        .sidebar-header { text-align: center; margin-bottom: 40px; }
        .sidebar-header h1 { color: var(--accent-gold); font-size: 1.8rem; }
        .sidebar nav ul { list-style: none; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .sidebar nav li a { display: flex; align-items: center; justify-content: center; color: var(--text-light); text-decoration: none; border-radius: 50%; font-size: 2.5rem; transition: background-color 0.3s, color 0.3s; width: 70px; height: 70px; }
        .sidebar nav li a .nav-text { display: none; }
        .sidebar nav li a:hover, .sidebar nav li a.active { background-color: var(--accent-gold); color: var(--primary-dark); font-weight: bold; }
        .main-content { margin-right: 120px; width: calc(100% - 120px); padding: 30px; transition: margin-right 0.3s ease-in-out; }
        .page { display: none; animation: fadeIn 0.5s ease-in-out; }
        .page.active { display: block; }
        .page-title { font-size: 2.5rem; color: var(--accent-gold); margin-bottom: 25px; border-bottom: 2px solid var(--secondary-dark); padding-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .menu-toggle { display: none; background: none; border: none; color: var(--accent-gold); font-size: 2rem; cursor: pointer; }
        .card { background-color: var(--primary-dark); padding: 25px; border-radius: var(--border-radius); box-shadow: var(--shadow); border: 1px solid var(--secondary-dark); margin-bottom: 25px; }
        .card-title { font-size: 1.7rem; color: var(--accent-gold); margin-bottom: 20px; border-bottom: 1px solid var(--secondary-dark); padding-bottom: 10px;}
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--text-muted); }
        .input-group input, .input-group select, .input-group textarea { width: 100%; padding: 12px; background-color: var(--bg-dark); border: 1px solid var(--secondary-dark); border-radius: 8px; color: var(--text-light); font-family: var(--font-body); font-size: 1rem; }
        .input-group textarea { resize: vertical; min-height: 100px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-block { display: block; width: 100%; }
        .btn-gold { background-color: var(--accent-gold); color: var(--primary-dark); }
        .btn-gold:hover { background-color: #eec44d; transform: translateY(-2px); }
        .btn-danger { background-color: var(--danger); color: var(--text-light); }
        .btn-danger:hover { background-color: #c82333; }
        .archive-group-title { color: var(--accent-gold); font-size: 1.2rem; margin-top: 30px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid var(--secondary-dark); }
        .activity-card { background-color: var(--secondary-dark); padding: 20px; border-radius: var(--border-radius); margin-bottom: 15px; display: flex; flex-direction: column; gap: 15px; border-left: 4px solid var(--accent-gold); }
        .activity-card.pending { border-left-color: var(--warning); }
        .activity-card.rejected { border-left-color: var(--danger); }
        .activity-card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .activity-card-header .title { font-size: 1.3rem; font-weight: bold; }
        .activity-card-header .date { font-size: 0.9rem; color: var(--text-muted); }
        .activity-status-badge { padding: 4px 10px; border-radius: 6px; font-size: 0.9rem; font-weight: bold; color: white; }
        .status-pending { background-color: var(--warning); color: var(--primary-dark); }
        .status-approved { background-color: var(--success); }
        .status-rejected { background-color: var(--danger); }
        .activity-card-details { border-top: 1px solid #3c4672; padding-top: 15px; }
        .activity-card-details p { margin-bottom: 8px; font-size: 0.95rem; word-break: break-word; }
        .activity-card-details strong { color: var(--text-muted); min-width: 120px; display: inline-block;}
        .activity-attachment img { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; }
        .activity-attachment a { display: inline-block; padding: 8px 15px; background-color: var(--primary-dark); color: var(--accent-gold); text-decoration: none; border-radius: 6px; margin-top: 10px; }
        .activity-attachment a:hover { background-color: #121828; }
        .remove-activity-btn { background: none; border: none; color: var(--danger); font-size: 1.5rem; cursor: pointer; padding: 0 5px; opacity: 0.7; transition: opacity 0.3s; }
        .remove-activity-btn:hover { opacity: 1; }
        .total-points-display { text-align: center; margin-bottom: 20px; }
        .total-points-display .value { font-size: 3rem; color: var(--accent-gold); font-weight: bold; }
        .total-points-display .label { font-size: 1.2rem; color: var(--text-muted); }
        #profile-page-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .profile-picture-container { position: relative; cursor: pointer; }
        #profile-picture { width: 150px; height: 150px; border-radius: 50%; border: 4px solid var(--accent-gold); object-fit: cover; background-color: var(--secondary-dark); }
        .profile-picture-container .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); color: white; display: flex; align-items: center; justify-content: center; border-radius: 50%; opacity: 0; transition: opacity 0.3s; font-size: 1rem; }
        .profile-picture-container:hover .overlay { opacity: 1; }
        #profile-picture-input { display: none; }
        #profile-info-display h3 { font-size: 1.8rem; color: var(--text-light); }
        #profile-info-display p { color: var(--text-muted); }
        #profile-form-container { width: 100%; max-width: 500px; margin-top: 20px; }
        .leaderboard-list { list-style: none; padding: 0; }
        .leaderboard-item { display: flex; align-items: center; padding: 15px; margin-bottom: 10px; background-color: var(--secondary-dark); border-radius: var(--border-radius); border-right: 5px solid transparent; transition: transform 0.2s; }
        .leaderboard-item:hover { transform: scale(1.02); }
        .leaderboard-item:nth-child(1) { border-color: #FFD700; } .leaderboard-item:nth-child(2) { border-color: #C0C0C0; } .leaderboard-item:nth-child(3) { border-color: #CD7F32; }
        .leaderboard-rank { font-size: 1.5rem; font-weight: bold; color: var(--accent-gold); min-width: 50px; text-align: center; }
        .leaderboard-pic { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-left: 15px; background-color: var(--primary-dark); }
        .leaderboard-name { font-size: 1.2rem; flex-grow: 1; }
        .leaderboard-points { font-size: 1.5rem; font-weight: bold; color: var(--text-light); }
        #auth-container { max-width: 400px; margin: 50px auto; padding: 20px; }
        .auth-form { display: none; } .auth-form.active { display: block; }
        .auth-toggle-link { color: var(--accent-gold); text-decoration: underline; cursor: pointer; margin-top: 15px; text-align: center; display: block; }
        .loader { text-align: center; padding: 50px; font-size: 1.5rem; color: var(--accent-gold); }
        #app-container { display: none; } /* Hidden by default */
        .status-message { text-align: center; padding: 10px; margin-bottom: 15px; border-radius: 8px; display: none; }
        .status-message.success { background-color: var(--success); color: white; }
        .status-message.error { background-color: var(--danger); color: white; }
        .app-footer { text-align: center; padding: 20px; margin-top: 40px; color: var(--text-muted); font-size: 0.9rem; }
        .app-footer a { color: var(--accent-gold); text-decoration: none; }
        /* *** STYLÃŠN NU JI BO PERRÃŠ SEREKI *** */
        .feed-activity-card {
            background-color: var(--primary-dark);
            border: 1px solid var(--secondary-dark);
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            overflow: hidden;
        }
        .feed-user-info {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--secondary-dark);
        }
        .feed-user-pic {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 15px;
            border: 2px solid var(--accent-gold);
        }
        .feed-user-name {
            font-weight: bold;
            color: var(--text-light);
        }
        .feed-activity-content {
            padding: 20px;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 992px) {
            .sidebar { transform: translateX(120px); z-index: 2000; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-right: 0; width: 100%; }
            .menu-toggle { display: block; }
        }
    </style>
</head>
<body>

    <div id="auth-container">
        <div class="card">
            <h1 style="text-align: center; color: var(--accent-gold); margin-bottom: 20px;">Ø±ÛØ¨ÙˆØ§Ø±Û Ø²Ø§Ù†ÛŒÙ†Û</h1>
            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <h3 class="card-title">Ú†ÙˆÙ†Ø§ Ú˜Û†Ø±Ú¤Û•</h3>
                <div id="login-status" class="status-message"></div>
                <div class="input-group">
                    <label for="login-email">Ø¦ÛŒÙ…ÛÙ„</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="input-group">
                    <label for="login-password">Ú˜Ù…Ø§Ø±Ø§ Ù†Ù‡ÛÙ†ÛŒ</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-gold btn-block">Ú†ÙˆÙ†Ø§ Ú˜Û†Ø±Ú¤Û•</button>
                <p style="text-align: center; margin-top: 15px;">
                    Ø¦Û•Ú¯Û•Ø± ØªÛ• Ù‡Ú˜Ù…Ø§Ø± Ù†Û•Ø¨ÛŒØªÙ† Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒÛ Ø¨ ÙÛ Ú˜Ù…Ø§Ø±Û Ø¨Ú©Û• Ù„Ø³Û•Ø± ÙˆØ§ØªØ³Ø¦Ø§Ù¾ÛŒ
                    <br>
                    <a href="https://wa.me/9647517959116" target="_blank" style="color: var(--accent-gold); text-decoration: underline; cursor: pointer;">
                        Ù Ù§Ù¥Ù¡ Ù§Ù©Ù¥ Ù©Ù¡Ù¡Ù¦
                    </a>
                </p>
            </form>

            <!-- Signup Form (Hidden) -->
            <form id="signup-form" class="auth-form" style="display: none;">
                <h3 class="card-title">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ù†Ø§ Ù‡Û•Ú˜Ù…Ø§Ø±Ø§ Ù†ÙˆÙˆ</h3>
                 <div id="signup-status" class="status-message"></div>
                <div class="input-group">
                    <label for="signup-fullname">Ù†Ø§Ú¤Û Ø³Û Ù‚ÙˆÙ„ÛŒ</label>
                    <input type="text" id="signup-fullname" required>
                </div>
                <div class="input-group">
                    <label for="signup-email">Ø¦ÛŒÙ…ÛÙ„</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="input-group">
                    <label for="signup-password">Ú˜Ù…Ø§Ø±Ø§ Ù†Ù‡ÛÙ†ÛŒ</label>
                    <input type="password" id="signup-password" required>
                </div>
                <button type="submit" class="btn btn-gold btn-block">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù†</button>
                <p class="auth-toggle-link" data-form="login">Ú˜ Ø¨Û•Ø±ÛŒ Ù†ÙˆÚ©Û• Ù‡Û•Ú˜Ù…Ø§Ø±Ø§ ØªÛ• Ù‡Û•ÛŒÛ•ØŸ Ø¨Ú†Û• Ú˜Û†Ø±Ú¤Û•</p>
            </form>
        </div>
    </div>

    <div id="app-container">
               <aside class="sidebar">
            <div class="sidebar-header"><h1>Ø±ÛØ¨ÙˆØ§Ø±Û Ø²Ø§Ù†ÛŒÙ†Û</h1></div>
            <nav>
                <ul>
                    <!-- ===================== LI VIR ZÃŠDE BIKE ===================== -->
                    <li><a href="#" class="nav-link active" data-page="main-feed-page" title="Ù¾Û•Ú•Û Ø³Û•Ø±Û•Ú©ÛŒ">ğŸ </a></li>
                    <!-- ========================================================== -->

                    <li><a href="#" class="nav-link" data-page="activities-page" title="Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ù…Ù†">ğŸ“</a></li> <!-- TÃŠBINI: Klassa 'active' Ú˜ Ú¤ÛØ±Û Ù‡Ø§ØªÛ• Ø±Ø§Ú©Ø±Ù† -->
                    <li><a href="#" class="nav-link" data-page="leaderboard-page" title="Ù¾ÛØ´Ø¨Ø±Ú©Û">ğŸ†</a></li>
                    <li><a href="#" class="nav-link" data-page="profile-page" title="Ù¾Ø±ÙˆÙØ§ÛŒÙ„">ğŸ‘¤</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <h2 class="page-title">
                <button class="menu-toggle" id="menu-toggle-btn">â˜°</button>
                <span id="page-title-text"></span>
            </h2>

            <!-- *** PERRÃŠ SEREKI YÃŠ NU *** -->
            <div id="main-feed-page" class="page">
                <div id="main-feed-container"><div class="loader">Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú¯Ø´ØªÛŒ Ø¯Ù‡ÛÙ†Û• Ø¨Ø§Ø±Ú©Ø±Ù†...</div></div>
            </div>

            <!-- Activities Page -->
            <div id="activities-page" class="page">
                <div class="card">
                    <h3 class="card-title">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù†Ø§ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§ Ù†ÙˆÙˆ</h3>
                    <div id="activity-status" class="status-message"></div>
                    <div class="input-group">
                        <label for="activity-type">Ø¬ÙˆØ±Û Ú†Ø§Ù„Ø§Ú©ÛŒÛ</label>
                        <select id="activity-type">
                             <option value="" disabled selected>Ø¬ÙˆØ±Û Ú†Ø§Ù„Ø§Ú©ÛŒÛ Ù‡Û•Ù„Ø¨Ú˜ÛØ±Û•...</option>
                             <option value="Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù…ÙØ§ÛŒÛÙ† Ø¨Ø§Ø¨Û•ØªØ§Ù†">âœï¸ Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù…ÙØ§ÛŒÛÙ† Ø¨Ø§Ø¨Û•ØªØ§Ù†</option>
                             <option value="Ù¾ÙˆØ®ØªÛ•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§ ÙˆÙ¾Û•Ø±ØªÙˆÚ©Ø§Ù†">ğŸ“š Ù¾ÙˆØ®ØªÛ•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù† Ùˆ Ù¾Û•Ø±ØªÙˆÚ©Ø§Ù†</option>
                             <option value="ØªÙØ±ÛŒØºØŒÙ†Ú¤ÛØ³ÛŒÙ†Ø§ Ø´Ø±ÙˆÚ¤Û•Ú©Ø±Ù†Ø§ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†">ğŸ§ Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ø´Ø±ÙˆÚ¤Û•Ú©Ø±Ù†Ø§ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù† (ØªÙØ±ÛŒØº)</option>
                             <option value="Ú†ÛÚ©Ø±Ù†Ø§ Ù†Û•Ø®Ø´Û Ù‡Ø²Ø±ÛŒ">ğŸ§  Ú†ÛÚ©Ø±Ù†Ø§ Ù†Û•Ø®Ø´Û Ù‡Ø²Ø±ÛŒ (ØªØ´Ø¬ÛŒØ±)</option>
                             <option value="Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ú•Ø§Ù¾ÙˆØ±ØªØ§Ù† ÙˆØ¯Ø§Ø±Ø´ØªÙ† ÙˆÙ…Û•Ù‚Ø§Ù„Ø§Ù†">ğŸ“„ Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ú•Ø§Ù¾Û†Ø±ØªØ§Ù† Ùˆ Ù…Ù‚Ø§Ù„Û•ÛŒÛÙ† Ø¹Ù„Ù…ÛŒ</option>
                             <option value="Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù¾Û•ÛŒÚ¤ ÙˆÚ•Ø§Ù…Ø§Ù†Ø§ Ù¾Û•ÛŒÚ¤ÛÙ† Ù‚Û†Ú•Ø¦Ø§Ù†Û">ğŸ“– Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù¾Û•ÛŒÚ¤ Ùˆ Ú•Ø§Ù…Ø§Ù†ÛÙ† Ù‚ÙˆØ±Ø¦Ø§Ù†Û</option>
                             <option value="Ú¯ÙˆØªÙ†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù† ÛŒØ§Ù† ÙˆØ§Ù†Û•Ú©Û">ğŸ¤ Ú¯ÙˆØªÙ†Ø§ Ø¨Ø§Ø¨Û•ØªÛ•Ú©Û ÛŒØ§Ù† ÙˆØ§Ù†Û•ÛŒÛ•Ú©Û</option>
                             <option value="ÙˆÛ•Ø±Ú¯ÛÚ•Ø§Ù†Ø§ Ù¾Û•Ø±ØªÙˆÚ©Ø§Ù†">ğŸŒ ÙˆÛ•Ø±Ú¯ÛÚ•Ø§Ù†Ø§ Ù¾Û•Ø±ØªÙˆÚ©Ø§Ù†</option>
                             <option value="Ù…Ú•Ø§Ø¬Ø¹Û• ÙˆØ¯ÙˆÙˆØ¨Ø§Ø±Û•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù†">ğŸ‘¥ Ø¯ÙˆÙˆØ¨Ø§Ø±Û•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù† Ø¯Ú¯Û•Ù„ Ù‚ÙˆØªØ§Ø¨ÛŒÛÙ† Ø¯ÛŒ</option>
                             <option value="Ø¨Û•Ø±ÛŒÚ©Ø§Ù†ÛÙ† Ø²Ø§Ù†Ø³ØªÛŒ ÙˆÚ˜Ø¨Û•Ø±Ú©Ø±Ù†Ø§ Ù…Û•ØªÙ†Ø§Ù†">ğŸ† Ø¨Û•Ø´Ø¯Ø§Ø±ÛŒÚ©Ø±Ù† Ø¯ Ø¨Û•Ø±ÛŒÚ©Ø§Ù†ÛÙ† Ø²Ø§Ù†Ø³ØªÛŒ Ø¯Ø§</option>
                             <option value="Ú©Ø§Ø±ÙˆÚ†Ø§ÚµØ§Ú©ÛŒÛÙ† Ú˜Ø¯Û•Ø±Ú¤Û•">ğŸ•Œ Ú©Ø§Ø± Ùˆ Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú˜Ø¯Û•Ø±Ú¤Û•</option>
                             <option value="Ú©Ø§Ø±ÛÙ† Ø¦Û•Ù„Ú©ØªØ±ÙˆÙ†ÛŒ">ğŸ’» Ú©Ø§Ø±ÛÙ† Ø¦Û•Ù„Ú©ØªØ±Û†Ù†ÛŒ (Ø¯ÛŒØ²Ø§ÛŒÙ†ØŒ Ù…Û†Ù†ØªØ§Ú˜...)</option>
                             <option value="Ø¯ÛŒØ§Ø±Ú©Ø±Ù†Ø§ Ú˜ÛØ¯Û•Ø±ÛÙ† Ø¨Ø§Ø¨Û•ØªÛ">ğŸ” Ø¯ÛŒØ§Ø±Ú©Ø±Ù†Ø§ Ú˜ÛØ¯Û•Ø±ÛÙ† Ø¨Ø§Ø¨Û•ØªØ§Ù†</option>
                             <option value="Ø¨ÙˆØ§Ø±Û Ú•Û•ÙˆØ´ØªÛŒ ÙˆØ¦Ø§Ø¯Ø§Ø¨Ø§">â¤ï¸ Ú¯Ø±Ù†Ú¯ÛŒØ¯Ø§Ù† Ø¨ Ø¨ÙˆØ§Ø±Û Ú•Û•ÙˆØ´Øª Ùˆ Ø¦Ø§Ø¯Ø§Ø¨Ø§Ù†</option>
                        </select>
                    </div>
                    <div id="dynamic-fields-container"></div>
                    <button id="add-activity-btn" class="btn btn-gold btn-block">Ù‡Ù†Ø§Ø±ØªÙ† Ø¨Û† Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±Ù†Û</button>
                </div>
                
                <!-- Pending Activities Section -->
                <div class="card">
                    <h3 class="card-title">Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Ú©Ø±ÛŒ</h3>
                    <div id="pending-activities-container"><div class="loader">Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Ú©Ø±ÛŒ Ø¯Ù‡ÛÙ†Û• Ø¨Ø§Ø±Ú©Ø±Ù†...</div></div>
                </div>

                <!-- Approved Activities (Archive) -->
                <div class="card">
                    <h3 class="card-title">Ø¦Û•Ø±Ø´ÛŒÙÛ Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±ÛŒ Ùˆ Ú©Û†Ù…Ø§ Ø®Ø§Ù„Ø§Ù†</h3>
                    <div class="total-points-display">
                        <div id="total-activity-points" class="value">0</div>
                        <div class="label">Ú©Û†Ù…Ø§ Ú¯Ø´ØªÛŒ ÛŒØ§ Ø®Ø§Ù„Ø§Ù†</div>
                    </div>
                    <div id="activities-archive"><div class="loader">Ú†Ø§Ù„Ø§Ú©ÛŒ Ø¯Ù‡ÛÙ†Û• Ø¨Ø§Ø±Ú©Ø±Ù†...</div></div>
                </div>
            </div>
            
            <!-- Leaderboard Page -->
            <div id="leaderboard-page" class="page">
                <div class="card">
                    <h3 class="card-title">Ù„ÛŒØ³ØªØ§ Ù¾ÛØ´Ø¨Ø±Ú©Û (Top 10)</h3>
                    <ul class="leaderboard-list" id="leaderboard-list"><div class="loader">Ù„ÛŒØ³Øª Ø¯Ù‡ÛØªÛ• Ø¨Ø§Ø±Ú©Ø±Ù†...</div></ul>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page">
                <div class="card">
                    <div id="profile-page-container">
                        <div class="profile-picture-container" id="profile-picture-wrapper">
                            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="WÃªneya ProfÃ®lÃª" id="profile-picture">
                            <input type="file" id="profile-picture-input" accept="image/*">
                            <div class="overlay">Ú¯ÙˆÙ‡Û†Ú•ÛŒÙ†Ø§ ÙˆÛÙ†Û•ÛŒ</div>
                        </div>
                        <div id="profile-info-display" style="text-align: center;">
                            <h3 id="display-full-name"></h3>
                            <p id="display-email"></p>
                        </div>
                        <div id="profile-form-container">
                            <h3 class="card-title">Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ù†Ø§ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒØ§Ù†</h3>
                            <div id="profile-status" class="status-message"></div>
                            <form id="profile-form">
                                <div class="input-group">
                                    <label for="full-name">Ù†Ø§Ú¤Û Ø³Û Ù‚ÙˆÙ„ÛŒ</label>
                                    <input type="text" id="full-name" required>
                                </div>
                                <div class="input-group">
                                    <label for="phone-number">Ú˜Ù…Ø§Ø±Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„Û</label>
                                    <input type="tel" id="phone-number">
                                </div>
                                <button type="submit" class="btn btn-gold btn-block">Ù¾Ø§Ø´Ú©Û•ÙØªÚ©Ø±Ù†Ø§ Ú¯ÙˆÙ‡Ø±ÛŒÙ†Ø§Ù†</button>
                            </form>
                            <button id="logout-btn" class="btn btn-danger btn-block" style="margin-top: 15px;">Ø¯Û•Ø±Ú©Û•ØªÙ†</button>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="app-footer">
                <p>Ø¦Û•Ú¤ Ø¨Û•Ø±Ù‡Û•Ù…Û• Ú˜ Ù„Ø§ÛŒÛ Ù¾Ø±Û†Ú˜Û Ø¦ÛŒØ³Ù„Ø§Ù… Ú¤Û• Ù‡Ø§ØªÛŒÛ• Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ù†</p>
                <a href="https://t.me/proje_islam" target="_blank">Ú©Û•Ù†Ø§ÚµÛ Ù…Û• Ù„ ØªÛÙ„ÛÚ¯Ø±Ø§Ù…ÛŒ</a>
            </footer>
        </main>
    </div>

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const firebaseConfig = {
            apiKey: "AIzaSyAs8Oj5Lxgi8R6qt3ZGkZqG9_9phqemQos",
            authDomain: "kurdish-c8391.firebaseapp.com",
            projectId: "kurdish-c8391",
            storageBucket: "kurdish-c8391.firebasestorage.app",
            messagingSenderId: "349871473333",
            appId: "1:349871473333:web:6c9cbf5ec692c20000b4fc"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let activitiesListener = null;

        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const authToggleLinks = document.querySelectorAll('.auth-toggle-link');
        const logoutBtn = document.getElementById('logout-btn');

        const showStatusMessage = (elementId, message, isError = false) => {
            const el = document.getElementById(elementId);
            if (!el) return;
            el.textContent = message;
            el.className = `status-message ${isError ? 'error' : 'success'}`;
            el.style.display = 'block';
            setTimeout(() => { el.style.display = 'none'; }, 5000);
        };
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => showStatusMessage('login-status', `Ø´Ø§Ø´ÛŒ: ${error.message}`, true));
        });

        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const fullName = signupForm['signup-fullname'].value;
            const email = signupForm['signup-email'].value;
            const password = signupForm['signup-password'].value;

            if (fullName.trim() === '') {
                 showStatusMessage('signup-status', 'ØªÚ©Ø§ÛŒÛ• Ù†Ø§Ú¤Û Ø®Û† Ø¨Ù†Ú¤ÛŒØ³Û•.', true);
                 return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        fullName: fullName,
                        email: email,
                        phone: '',
                        profilePictureURL: null,
                        points: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .catch(error => showStatusMessage('signup-status', `Ø´Ø§Ø´ÛŒ: ${error.message}`, true));
        });
        
        logoutBtn.addEventListener('click', () => {
            if (activitiesListener) {
                activitiesListener(); 
                activitiesListener = null;
            }
            auth.signOut();
        });

        authToggleLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const targetFormId = e.target.dataset.form;
                document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                document.getElementById(`${targetFormId}-form`).classList.add('active');
            });
        });

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                authContainer.style.display = 'none';
                appContainer.style.display = 'block';
                initializeApp(user);
            } else {
                currentUser = null;
                authContainer.style.display = 'block';
                appContainer.style.display = 'none';
                if (activitiesListener) {
                    activitiesListener();
                    activitiesListener = null;
                }
            }
        });

        function initializeApp(user) {
            setupNavigation();
            renderProfile(user.uid); 
            setupActivitiesListener(user.uid);
            
            const userDocRef = db.collection('users').doc(user.uid);
            userDocRef.get().then(doc => {
                if (doc.exists && (!doc.data().phone || doc.data().phone.trim() === '')) {
                    showPage('profile-page');
                    showStatusMessage('profile-status', 'ØªÚ©Ø§ÛŒÛ• Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛÙ† Ù¾Ø±Û†ÙØ§ÛŒÙ„Û Ø®Û† ØªÛ•Ù…Ø§Ù… Ø¨Ú©Û•ØŒ Ø¨ ØªØ§ÛŒØ¨Û•Øª Ú˜Ù…Ø§Ø±Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„Û.', false);
                } else {
                    // *** LI DESTPÃŠKÃŠ PERRÃŠ SEREKI NÃSHAN BIDE ***
                    showPage('main-feed-page');
                }
            }).catch(err => {
                console.error("Error checking user profile:", err);
                showPage('main-feed-page');
            });
        }

        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(e.currentTarget.dataset.page);
            }));
            document.getElementById('menu-toggle-btn').addEventListener('click', () => {
                document.querySelector('.sidebar').classList.toggle('open');
            });
        }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(l => {
                l.classList.remove('active');
                if (l.dataset.page === pageId) {
                    l.classList.add('active');
                    document.getElementById('page-title-text').textContent = l.getAttribute('title') || '';
                }
            });
            document.querySelector('.sidebar').classList.remove('open');
            
            if (pageId === 'leaderboard-page') {
                renderLeaderboard();
            }
            // *** DEMA PERRÃŠ SEREKI VEBE, FUNKSIONA WÃŠ BANG BIKE ***
            if (pageId === 'main-feed-page') {
                renderMainFeed();
            }
        }
        
        const profileForm = document.getElementById('profile-form');
        const fullNameInput = document.getElementById('full-name');
        const phoneInput = document.getElementById('phone-number');
        const profilePicImg = document.getElementById('profile-picture');
        const profilePicInput = document.getElementById('profile-picture-input');
        const profilePicWrapper = document.getElementById('profile-picture-wrapper');
        const displayFullName = document.getElementById('display-full-name');
        const displayEmail = document.getElementById('display-email');
        
        async function renderProfile(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const profile = userDoc.data();
                    fullNameInput.value = profile.fullName || '';
                    phoneInput.value = profile.phone || '';
                    displayFullName.textContent = profile.fullName || 'Ø¨Û Ù†Ø§Ú¤';
                    displayEmail.textContent = profile.email || 'Ø¨Û Ø¦ÛŒÙ…ÛÙ„';
                    profilePicImg.src = profile.profilePictureURL || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
                }
            } catch(error) {
                console.error("Error fetching profile:", error);
                showStatusMessage('profile-status', 'Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø¦ÛŒÙ†Ø§Ù†Ø§ Ù¾Ø±Û†ÙØ§ÛŒÙ„Û Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§', true);
            }
        }

        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;
            const updatedProfile = {
                fullName: fullNameInput.value,
                phone: phoneInput.value
            };
            try {
                await db.collection('users').doc(currentUser.uid).set(updatedProfile, { merge: true });
                showStatusMessage('profile-status', 'Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ø¨ Ø³Û•Ø±Ú©Û•ÙØªÛŒØ§Ù†Û• Ù‡Ø§ØªÙ†Û• Ù¾Ø§Ø´Ú©Û•ÙØªÚ©Ø±Ù†.');
                renderProfile(currentUser.uid);
            } catch (error) {
                showStatusMessage('profile-status', `Ø´Ø§Ø´ÛŒ: ${error.message}`, true);
            }
        });

        profilePicWrapper.addEventListener('click', () => profilePicInput.click());
        profilePicInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file || !currentUser) return;
            
            if (file.size > 2 * 1024 * 1024) { // 2 MB limit
                showStatusMessage('profile-status', 'ÙØ§ÛŒÙ„Û Ø¨Ù„Ù†Ø¯Ú©Ø±ÛŒ Ú¯Û•Ù„Û•Ú© Ù…Û•Ø²Ù†Û•. ØªÚ©Ø§ÛŒÛ• ÙØ§ÛŒÙ„Û•Ú©Û Ø¨Ú†ÙˆÙˆÚ©ØªØ± Ú˜ 2MB Ø¨Ù„Ù†Ø¯Ú©Û•.', true);
                return;
            }

            showStatusMessage('profile-status', 'ÙˆÛÙ†Û• Ø¯Ù‡ÛØªÛ• Ø¨Ù„Ù†Ø¯Ú©Ø±Ù†...');
            const reader = new FileReader();
            reader.onloadend = async () => {
                const base64String = reader.result;
                try {
                    await db.collection('users').doc(currentUser.uid).set({ profilePictureURL: base64String }, { merge: true });
                    showStatusMessage('profile-status', 'ÙˆÛÙ†Û• Ø¨ Ø³Û•Ø±Ú©Û•ÙØªÛŒØ§Ù†Û• Ù‡Ø§ØªÛ• Ø¨Ù„Ù†Ø¯Ú©Ø±Ù†.');
                    renderProfile(currentUser.uid);
                } catch (error) {
                    showStatusMessage('profile-status', `Ø´Ø§Ø´ÛŒ: ${error.message}`, true);
                }
            };
            reader.onerror = () => {
                 showStatusMessage('profile-status', 'Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø®ÙˆØ§Ù†Ø¯Ù†Ø§ ÙˆÛÙ†Û•ÛŒ Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.', true);
            }
            reader.readAsDataURL(file);
        });

        const activityTypeSelect = document.getElementById('activity-type');
        const dynamicFieldsContainer = document.getElementById('dynamic-fields-container');
        const addActivityBtn = document.getElementById('add-activity-btn');
        const activitiesArchive = document.getElementById('activities-archive');
        const pendingContainer = document.getElementById('pending-activities-container');
        const totalPointsDisplay = document.getElementById('total-activity-points');
        
        const fileInputHTML = `<div class="input-group"><label for="activity-file">Ø¨Ù„Ù†Ø¯Ú©Ø±Ù†Ø§ ÙØ§ÛŒÙ„Û•Ú©Û (ÙˆÛÙ†Û•ØŒ PDF...)</label><input type="file" id="activity-file" accept="image/*,application/pdf,.doc,.docx,.ppt,.pptx"></div>`;
        const activityFields = {
             'Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù…ÙØ§ÛŒÛÙ† Ø¨Ø§Ø¨Û•ØªØ§Ù†': `<div class="input-group"><label for="source">Ú˜ÛØ¯Û•Ø± (Ù¾Û•Ø±ØªÙˆÙˆÚ©ØŒ ÙˆØ§Ù†Û•)</label><input type="text" id="source" required></div><div class="input-group"><label for="details">Ù…ÙØ§ÛŒÛÙ† Ù‡Ø§ØªÛŒÙ†Û• Ù†Ú¤ÛØ³ÛŒÙ†</label><textarea id="details" required></textarea></div>${fileInputHTML}`,
             'Ù¾ÙˆØ®ØªÛ•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§ ÙˆÙ¾Û•Ø±ØªÙˆÚ©Ø§Ù†': `<div class="input-group"><label for="book-title">Ù†Ø§Ú¤Û Ù¾Û•Ø±ØªÙˆÙˆÚ©Û/Ø¨Ø§Ø¨Û•ØªÛ</label><input type="text" id="book-title" required></div><div class="input-group"><label for="author">Ù†Ú¤ÛŒØ³Û•Ø±</label><input type="text" id="author"></div>${fileInputHTML}`,
             'ØªÙØ±ÛŒØºØŒÙ†Ú¤ÛØ³ÛŒÙ†Ø§ Ø´Ø±ÙˆÚ¤Û•Ú©Ø±Ù†Ø§ Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒØ§Ù†': `<div class="input-group"><label for="teacher-name">Ù†Ø§Ú¤Û Ù…Ø§Ù…Û†Ø³ØªØ§ÛŒ</label><input type="text" id="teacher-name" required></div><div class="input-group"><label for="lesson-title">Ù†Ø§Ú¤Ù†ÛŒØ´Ø§Ù†Û ÙˆØ§Ù†Û•ÛŒÛ</label><input type="text" id="lesson-title" required></div>${fileInputHTML}`,
             'Ú†ÛÚ©Ø±Ù†Ø§ Ù†Û•Ø®Ø´Û Ù‡Ø²Ø±ÛŒ': `<div class="input-group"><label for="topic">Ø¨Ø§Ø¨Û•Øª</label><input type="text" id="topic" required></div><div class="input-group"><label for="activity-file">ÙˆÛÙ†Û Ù†Û•Ø®Ø´Û Ù‡Ø²Ø±ÛŒ Ø¨Ù„Ù†Ø¯Ú©Û•</label><input type="file" id="activity-file" accept="image/*" required></div>`,
             'Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ú•Ø§Ù¾ÙˆØ±ØªØ§Ù† ÙˆØ¯Ø§Ø±Ø´ØªÙ† ÙˆÙ…Û•Ù‚Ø§Ù„Ø§Ù†': `<div class="input-group"><label for="report-title">Ù†Ø§Ú¤Ù†ÛŒØ´Ø§Ù†</label><input type="text" id="report-title" required></div>${fileInputHTML}`,
             'Ù†Ú¤ÛØ³ÛŒÙ†Ø§ Ù¾Û•ÛŒÚ¤ ÙˆÚ•Ø§Ù…Ø§Ù†Ø§ Ù¾Û•ÛŒÚ¤ÛÙ† Ù‚Û†Ú•Ø¦Ø§Ù†Û': `<div class="input-group"><label for="surah">Ø³ÙˆØ±Ø©</label><input type="text" id="surah" required></div><div class="input-group"><label for="words-details">Ù¾Û•ÛŒÚ¤ Ùˆ Ú•Ø§Ù…Ø§Ù†</label><textarea id="words-details" required></textarea></div>${fileInputHTML}`,
             'Ú¯ÙˆØªÙ†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù† ÛŒØ§Ù† ÙˆØ§Ù†Û•Ú©Û': `<div class="input-group"><label for="talk-topic">Ø¨Ø§Ø¨Û•Øª</label><input type="text" id="talk-topic" required></div><div class="input-group"><label for="location">Ø¬Ù‡Ù€</label><input type="text" id="location"></div>${fileInputHTML}`,
             'ÙˆÛ•Ø±Ú¯ÛÚ•Ø§Ù†Ø§ Ù¾Û•Ø±ØªÙˆÚ©Ø§Ù†': `<div class="input-group"><label for="original-title">Ù†Ø§Ú¤Û Ù¾Û•Ø±ØªÙˆÙˆÚ©Û</label><input type="text" id="original-title" required></div><div class="input-group"><label for="original-author">Ù†Ú¤ÛŒØ³Û•Ø±</label><input type="text" id="original-author"></div>${fileInputHTML}`,
             'Ù…Ú•Ø§Ø¬Ø¹Û• ÙˆØ¯ÙˆÙˆØ¨Ø§Ø±Û•Ú©Ø±Ù†Ø§ Ø¨Ø§Ø¨Û•ØªØ§Ù†': `<div class="input-group"><label for="review-topic">Ø¨Ø§Ø¨Û•ØªÛ Ù‡Ø§ØªÛŒÛ• Ø¯ÙˆÙˆØ¨Ø§Ø±Û•Ú©Ø±Ù†</label><input type="text" id="review-topic" required></div><div class="input-group"><label for="partners">Ù†Ø§Ú¤ÛÙ† Ù‡Û•Ú¤Ø§Ù„ÛÙ† Ù¾Ø´Ú©Ø¯Ø§Ø±</label><input type="text" id="partners"></div>${fileInputHTML}`,
             'Ø¨Û•Ø±ÛŒÚ©Ø§Ù†ÛÙ† Ø²Ø§Ù†Ø³ØªÛŒ ÙˆÚ˜Ø¨Û•Ø±Ú©Ø±Ù†Ø§ Ù…Û•ØªÙ†Ø§Ù†': `<div class="input-group"><label for="competition-name">Ù†Ø§Ú¤Û Ø¨Û•Ø±ÛŒÚ©Ø§Ù†Û</label><input type="text" id="competition-name" required></div><div class="input-group"><label for="rank">Ù¾Ù„Û•</label><input type="text" id="rank"></div>${fileInputHTML}`,
             'Ú©Ø§Ø±ÙˆÚ†Ø§ÚµØ§Ú©ÛŒÛÙ† Ú˜Ø¯Û•Ø±Ú¤Û•': `<div class="input-group"><label for="external-type">Ø¬ÙˆØ±Û Ú†Ø§Ù„Ø§Ú©ÛŒÛ (Ø¯Û•Ø±Ø³ØŒ ÙˆØªØ§Ø±...)</label><input type="text" id="external-type" required></div><div class="input-group"><label for="external-location">Ø¬Ù‡Ù€</label><input type="text" id="external-location"></div>${fileInputHTML}`,
             'Ú©Ø§Ø±ÛÙ† Ø¦Û•Ù„Ú©ØªØ±ÙˆÙ†ÛŒ': `<div class="input-group"><label for="electronic-type">Ø¬ÙˆØ±Û Ú©Ø§Ø±ÛŒ (Ø¯ÛŒØ²Ø§ÛŒÙ†ØŒ Ù…Û†Ù†ØªØ§Ú˜...)</label><input type="text" id="electronic-type" required></div><div class="input-group"><label for="work-link">Ù„ÛŒÙ†Ú©Û Ú©Ø§Ø±ÛŒ</label><input type="url" id="work-link"></div>${fileInputHTML}`,
             'Ø¯ÛŒØ§Ø±Ú©Ø±Ù†Ø§ Ú˜ÛØ¯Û•Ø±ÛÙ† Ø¨Ø§Ø¨Û•ØªÛ': `<div class="input-group"><label for="source-topic">Ø¨Ø§Ø¨Û•Øª</label><input type="text" id="source-topic" required></div><div class="input-group"><label for="sources-list">Ù„ÛŒØ³ØªØ§ Ú˜ÛØ¯Û•Ø±Ø§Ù†</label><textarea id="sources-list" required></textarea></div>${fileInputHTML}`,
             'Ø¨ÙˆØ§Ø±Û Ú•Û•ÙˆØ´ØªÛŒ ÙˆØ¦Ø§Ø¯Ø§Ø¨Ø§': `<div class="input-group"><label for="ethics-situation">Ø¨Ø§Ø±ÙˆØ¯Û†Ø® ÛŒØ§Ù† Ú†Ø§Ù„Ø§Ú©ÛŒ</label><input type="text" id="ethics-situation" required></div><div class="input-group"><label for="ethics-details">Ú†Û•ÙˆØ§Ù†ÛŒØ§ Ú¯Ø±Ù†Ú¯ÛŒØ¯Ø§Ù† Ø¨ Ú•Û•ÙˆØ´Øª Ùˆ Ø¦Ø§Ø¯Ø§Ø¨Ø§Ù†</label><textarea id="ethics-details" required></textarea></div>${fileInputHTML}`
        };

        activityTypeSelect.addEventListener('change', (e) => dynamicFieldsContainer.innerHTML = activityFields[e.target.value] || '');

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        addActivityBtn.addEventListener('click', async () => {
            const type = activityTypeSelect.value;
            if (!type || !currentUser) {
                showStatusMessage('activity-status', 'ØªÚ©Ø§ÛŒÛ• Ø¬ÙˆØ±Û Ú†Ø§Ù„Ø§Ú©ÛŒÛ Ù‡Û•Ù„Ø¨Ú˜ÛØ±Û•.', true);
                return;
            }

            const newActivity = {
                userId: currentUser.uid,
                type: type,
                date: new Date().toISOString(),
                status: 'pending', 
                data: {},
                fileDataURL: null,
                fileName: null,
            };

            const inputs = dynamicFieldsContainer.querySelectorAll('input, textarea');
            let isFormValid = true;
            inputs.forEach(input => {
                if (input.required && !input.value.trim()) isFormValid = false;
                if (input.type !== 'file' && input.value) {
                    const label = dynamicFieldsContainer.querySelector(`label[for='${input.id}']`);
                    if (label) newActivity.data[label.textContent] = input.value;
                }
            });

            if (!isFormValid) {
                showStatusMessage('activity-status', 'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÛŒ Ø®Ø§Ù†Û•ÛŒÛÙ† Ù¾ÛØ¯Ú¤ÛŒ Ù¾Ø±Ø¨Ú©Û•Ø±Û•ÙˆÛ•.', true);
                return;
            }
            
            addActivityBtn.disabled = true;
            addActivityBtn.textContent = 'Ù„ Ù‡ÛŒÚ¤ÛŒÛ Ø¨Û•...';

            const fileInput = document.getElementById('activity-file');
            if (fileInput && fileInput.files[0]) {
                const file = fileInput.files[0];
                
                if (file.size > 2 * 1024 * 1024) { // 2 MB limit
                    showStatusMessage('activity-status', 'ÙØ§ÛŒÙ„Û Ø¨Ù„Ù†Ø¯Ú©Ø±ÛŒ Ú¯Û•Ù„Û•Ú© Ù…Û•Ø²Ù†Û•. ØªÚ©Ø§ÛŒÛ• ÙØ§ÛŒÙ„Û•Ú©Û Ø¨Ú†ÙˆÙˆÚ©ØªØ± Ú˜ 2MB Ø¨Ù„Ù†Ø¯Ú©Û•.', true);
                    addActivityBtn.disabled = false;
                    addActivityBtn.textContent = 'Ù‡Ù†Ø§Ø±ØªÙ† Ø¨Û† Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±Ù†Û';
                    return;
                }

                try {
                    newActivity.fileDataURL = await fileToBase64(file);
                    newActivity.fileName = file.name;
                } catch (error) {
                    showStatusMessage('activity-status', `Ø´Ø§Ø´ÛŒ Ø¯ Ø®ÙˆØ§Ù†Ø¯Ù†Ø§ ÙØ§ÛŒÙ„Û Ø¯Ø§: ${error.message}`, true);
                    addActivityBtn.disabled = false;
                    addActivityBtn.textContent = 'Ù‡Ù†Ø§Ø±ØªÙ† Ø¨Û† Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±Ù†Û';
                    return;
                }
            }

            try {
                await db.collection('activities').add(newActivity);
                showStatusMessage('activity-status', 'Ú†Ø§Ù„Ø§Ú©ÛŒ Ø¨ Ø³Û•Ø±Ú©Û•ÙØªÛŒØ§Ù†Û• Ù‡Ø§ØªÛ• Ù‡Ù†Ø§Ø±ØªÙ† Ùˆ Ù„ Ù‡ÛŒÚ¤ÛŒØ§ Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±Ù†Û ÛŒÛ•.');
                activityTypeSelect.value = '';
                dynamicFieldsContainer.innerHTML = '';
            } catch (error) {
                showStatusMessage('activity-status', `Ø´Ø§Ø´ÛŒ Ø¯ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù†Û Ø¯Ø§: ${error.message}`, true);
            } finally {
                addActivityBtn.disabled = false;
                addActivityBtn.textContent = 'Ù‡Ù†Ø§Ø±ØªÙ† Ø¨Û† Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±Ù†Û';
            }
        });
        
        function setupActivitiesListener(userId) {
            if (activitiesListener) activitiesListener();
            
            activitiesListener = db.collection('activities')
                .where('userId', '==', userId)
                .orderBy('date', 'desc')
                .onSnapshot(snapshot => {
                    const allActivities = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    const approvedActivities = allActivities.filter(a => a.status === 'approved');
                    const pendingActivities = allActivities.filter(a => a.status === 'pending' || a.status === 'rejected');
                    
                    renderActivities(approvedActivities, activitiesArchive);
                    renderPendingActivities(pendingActivities, pendingContainer);
                    updateUserPoints(userId, approvedActivities);

                }, error => {
                    console.error("Error fetching activities:", error);
                    activitiesArchive.innerHTML = '<p style="color:var(--danger)">Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø¦ÛŒÙ†Ø§Ù†Ø§ Ú†Ø§Ù„Ø§Ú©ÛŒØ§Ù† Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.</p>';
                    pendingContainer.innerHTML = '<p style="color:var(--danger)">Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø¦ÛŒÙ†Ø§Ù†Ø§ Ú†Ø§Ù„Ø§Ú©ÛŒØ§Ù† Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.</p>';
                });
        }
        
        async function updateUserPoints(userId, approvedActivities) {
            const uniqueTypes = new Set(approvedActivities.map(act => act.type));
            const points = uniqueTypes.size * 2; // Her jorekÃª Ã§alakiya pesendkirÃ® 2 xal in
            totalPointsDisplay.textContent = points;
            
            try {
                await db.collection('users').doc(userId).set({ points: points }, { merge: true });
            } catch (error) {
                console.error("Error updating points:", error);
            }
        }
        
        function renderActivities(activities, container) {
            if (activities.length === 0) {
                container.innerHTML = '<p style="text-align:center; color: var(--text-muted);">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§ Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±ÛŒ Ù†Û•Ù‡Ø§ØªÛŒÛ• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù†.</p>';
                return;
            }
            container.innerHTML = activities.map(activity => renderActivityCard(activity)).join('');
        }
        
        function renderPendingActivities(activities, container) {
            if (activities.length === 0) {
                container.innerHTML = '<p style="text-align:center; color: var(--text-muted);">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú© Ù„ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒÛ Ù†ÛŒÙ†Û•.</p>';
                return;
            }
            container.innerHTML = activities.map(activity => renderActivityCard(activity)).join('');
        }

        function renderActivityCard(activity) {
            const statusClasses = {
                pending: 'status-pending',
                approved: 'status-approved',
                rejected: 'status-rejected'
            };
            const statusTexts = {
                pending: 'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•',
                approved: 'Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±ÛŒ',
                rejected: 'Ú•Û•ØªÚ©Ø±ÛŒ'
            };
            const statusClass = statusClasses[activity.status] || '';
            const statusText = statusTexts[activity.status] || activity.status;
            
            let detailsHtml = Object.entries(activity.data).map(([key, value]) => `<p><strong>${key}:</strong> <span>${value}</span></p>`).join('');
            let attachmentHtml = '';

            if (activity.fileDataURL) {
                 const isImage = activity.fileName && /\.(jpe?g|png|gif|webp|bmp)$/i.test(activity.fileName);
                 if (isImage) {
                     attachmentHtml = `<div class="activity-attachment">
                         <img src="${activity.fileDataURL}" alt="${activity.fileName || 'WÃªneya Ã§alakiyÃª'}" />
                         <br>
                         <a href="${activity.fileDataURL}" target="_blank" download="${activity.fileName || 'wene.jpg'}">Ø¯Ø§Ú¯Ø±ØªÙ†Ø§ ÙˆÛÙ†Û•ÛŒ</a>
                     </div>`;
                 } else {
                     attachmentHtml = `<div class="activity-attachment">
                        <a href="${activity.fileDataURL}" target="_blank" download="${activity.fileName}">Ø¯Ø§Ú¯Ø±ØªÙ†Ø§ ÙØ§ÛŒÙ„Û (${activity.fileName})</a>
                     </div>`;
                 }
            }
            
            return `
                <div class="activity-card ${activity.status}">
                    <div class="activity-card-header">
                        <div>
                            <div class="title">${activity.type.split(' ').slice(1).join(' ')}</div>
                            <div class="date">${new Date(activity.date).toLocaleDateString('ku-IQ', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                        </div>
                        <div>
                            <span class="activity-status-badge ${statusClass}">${statusText}</span>
                            ${(activity.status === 'pending' || activity.status === 'rejected') ? `<button class="remove-activity-btn" data-id="${activity.id}" title="Ú˜ÛØ¨Ø±Ù†">&times;</button>` : ''}
                        </div>
                    </div>
                    <div class="activity-card-details">
                        ${detailsHtml}
                        ${attachmentHtml}
                    </div>
                </div>`;
        }
        
        document.getElementById('app-container').addEventListener('click', async (e) => {
            if (e.target.classList.contains('remove-activity-btn')) {
                const activityId = e.target.dataset.id;
                if (confirm('ØªÙˆ ÛŒÛ Ù¾Ø´ØªØ±Ø§Ø³ØªÛŒ Ø¯Û Ú¤Û Ú†Ø§Ù„Ø§Ú©ÛŒÛ Ú˜ÛØ¨Û•ÛŒØŸ (Ø¦Û•Ú¤ Ú©Ø§Ø±Û• Ù†Ø§Ù‡ÛØªÛ• Ú¤Û•Ú¯Û•Ø±Ø§Ù†Ø¯Ù†)')) {
                    try {
                        await db.collection('activities').doc(activityId).delete();
                    } catch (error) {
                        console.error("Error removing activity:", error);
                        alert("Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ú˜ÛØ¨Ø±Ù†Ø§ Ú†Ø§Ù„Ø§Ú©ÛŒÛ Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.");
                    }
                }
            }
        });

        async function renderLeaderboard() {
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '<div class="loader">Ù„ÛŒØ³Øª Ø¯Ù‡ÛØªÛ• Ø¨Ø§Ø±Ú©Ø±Ù†...</div>';
            
            try {
                const snapshot = await db.collection('users').orderBy('points', 'desc').limit(10).get();
                if(snapshot.empty) {
                    leaderboardList.innerHTML = '<p style="text-align:center; color: var(--text-muted);">Ù‡ÛŒÚ† Ø¨Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±Û•Ú© Ù†Û•Ù‡Ø§ØªÛ• Ø¯ÛŒØªÙ†.</p>';
                    return;
                }
                let html = '';
                let rank = 1;
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const defaultPic = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
                    html += `
                        <li class="leaderboard-item">
                            <span class="leaderboard-rank">${rank++}</span>
                            <img src="${user.profilePictureURL || defaultPic}" alt="WÃªne" class="leaderboard-pic">
                            <span class="leaderboard-name">${user.fullName || 'Ø¨Û Ù†Ø§Ú¤'}</span>
                            <span class="leaderboard-points">${user.points || 0} Ø®Ø§Ù„</span>
                        </li>`;
                });
                leaderboardList.innerHTML = html;
            } catch (error) {
                console.error("Error fetching leaderboard:", error);
                leaderboardList.innerHTML = '<p style="color:var(--danger); text-align: center;">Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø¦ÛŒÙ†Ø§Ù†Ø§ Ù„ÛŒØ³ØªÛ Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.</p>';
            }
        }
        
        // *** FUNKSIONA NU JI BO NÃSHANDANA Ã‡ALAKIYÃŠN HEMI QUTABIYAN ***
        async function renderMainFeed() {
            const feedContainer = document.getElementById('main-feed-container');
            feedContainer.innerHTML = '<div class="loader">Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú¯Ø´ØªÛŒ Ø¯Ù‡ÛÙ†Û• Ø¨Ø§Ø±Ú©Ø±Ù†...</div>';

            try {
                const activitiesSnapshot = await db.collection('activities')
                    .where('status', '==', 'approved')
                    .orderBy('date', 'desc')
                    .limit(30) // TÃªnÃª 30 Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† nÃ»tir nÃ®shan bide
                    .get();

                if (activitiesSnapshot.empty) {
                    feedContainer.innerHTML = '<p style="text-align:center; color: var(--text-muted);">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§ Ù¾Û•Ø³Û•Ù†Ø¯Ú©Ø±ÛŒ ÛŒØ§ Ú¯Ø´ØªÛŒ Ù†ÛŒÙ†Û• Ú©Ùˆ Ø¨Ù‡ÛØªÛ• Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†.</p>';
                    return;
                }

                // Komkirina ID-yÃªn bikarhÃªneran daku carekÃª datayÃªn wan bÃªn wergirtin
                const userIds = [...new Set(activitiesSnapshot.docs.map(doc => doc.data().userId))];
                const usersData = {};
                
                // Wergirtina datayÃªn bikarhÃªneran
                for (const userId of userIds) {
                    const userDoc = await db.collection('users').doc(userId).get();
                    if (userDoc.exists) {
                        usersData[userId] = userDoc.data();
                    }
                }

                let html = '';
                activitiesSnapshot.forEach(doc => {
                    const activity = { id: doc.id, ...doc.data() };
                    const user = usersData[activity.userId];
                    if (user) {
                        html += renderFeedActivityCard(activity, user);
                    }
                });

                feedContainer.innerHTML = html;
            } catch (error) {
                console.error("Error fetching main feed:", error);
                feedContainer.innerHTML = '<p style="color:var(--danger); text-align: center;">Ø´Ø§Ø´ÛŒÛ•Ú© Ø¯ Ø¦ÛŒÙ†Ø§Ù†Ø§ Ú†Ø§Ù„Ø§Ú©ÛŒÛÙ† Ú¯Ø´ØªÛŒ Ø¯Ø§ Ú•ÙˆÙˆÛŒØ¯Ø§.</p>';
            }
        }

        // *** FUNKSIONA NU JI BO DRUSTKIRINA KARTÃŠN Ã‡ALAKIYAN LI PERRÃŠ SEREKI ***
        function renderFeedActivityCard(activity, user) {
            const defaultPic = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
            let detailsHtml = Object.entries(activity.data).map(([key, value]) => `<p><strong>${key}:</strong> <span>${value}</span></p>`).join('');
            let attachmentHtml = '';

            if (activity.fileDataURL) {
                 const isImage = activity.fileName && /\.(jpe?g|png|gif|webp|bmp)$/i.test(activity.fileName);
                 if (isImage) {
                     attachmentHtml = `<div class="activity-attachment"><img src="${activity.fileDataURL}" alt="${activity.fileName || 'WÃªneya Ã§alakiyÃª'}" /></div>`;
                 } else {
                     attachmentHtml = `<div class="activity-attachment"><a href="${activity.fileDataURL}" target="_blank" download="${activity.fileName}">Ø¯Ø§Ú¯Ø±ØªÙ†Ø§ ÙØ§ÛŒÙ„Û (${activity.fileName})</a></div>`;
                 }
            }

            return `
                <div class="feed-activity-card">
                    <div class="feed-user-info">
                        <img src="${user.profilePictureURL || defaultPic}" alt="WÃªne" class="feed-user-pic">
                        <div>
                            <div class="feed-user-name">${user.fullName || 'Ø¨Û Ù†Ø§Ú¤'}</div>
                            <div class="date">${new Date(activity.date).toLocaleDateString('ku-IQ', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                        </div>
                    </div>
                    <div class="feed-activity-content">
                        <h4 class="card-title" style="font-size: 1.4rem;">${activity.type}</h4>
                        <div class="activity-card-details">
                            ${detailsHtml}
                            ${attachmentHtml}
                        </div>
                    </div>
                </div>
            `;
        }

    });
    </script>
</body>
</html>
